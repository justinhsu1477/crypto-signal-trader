app:
  timezone: Asia/Taipei

# ========== 多用戶跟單開關 ==========
multi-user:
  enabled: ${MULTI_USER_ENABLED:false}      # true = 啟用多用戶模式, false = 舊系統
  rabbitmq:
    enabled: ${RABBITMQ_ENABLED:false}      # true = 用 RabbitMQ，false = 同步執行

# ========== 多用戶支援配置 ==========
trading:
  user-id: ${TRADING_USER_ID:test-user}  # 當前交易用戶 ID（舊系統用）
                                          # 開發/測試: test-user
                                          # 生產: 從環境變數讀取真實用戶 ID

server:
  port: ${SERVER_PORT:8080}

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USER:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: /
  datasource:
    url: ${DB_URL:jdbc:postgresql://localhost:5432/trading}
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME:trading}
    password: ${DB_PASSWORD:trading}
    hikari:
      maximum-pool-size: ${HIKARI_MAX_POOL_SIZE:20}  # 配合廣播線程池 max=50，留 buffer
      minimum-idle: 5
      connection-timeout: 10000     # 10 秒等不到連線就失敗
      idle-timeout: 300000          # 閒置 5 分鐘回收
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect

binance:
  futures:
    api-key: ${BINANCE_API_KEY:YOUR_API_KEY}
    secret-key: ${BINANCE_SECRET_KEY:YOUR_SECRET_KEY}

  # 風控設定
  risk:
    max-position-usdt: 50000      # 單筆最大名目價值 (USDT) — 防止窄止損產生超大倉位
    max-daily-loss-usdt: 2000     # 每日虧損熔斷上限 (USDT) — 固定值，不隨餘額浮動
    # 動態以損定倉: 1R = 帳戶餘額 × risk-percent, 補倉用 2R
    risk-percent: 0.20            # 單筆風險比例 (20% = 0.20)
    max-dca-per-symbol: 3         # 同幣種最多 3 層（首次入場 + 2 次補倉）
    dca-risk-multiplier: 2.0      # 補倉風險倍數（2R = 首倉的 2 倍風險金額）
    fixed-leverage: 20            # 固定槓桿 (逐倉 ISOLATED)
    default-symbol: BTCUSDT        # 訊號無幣種時的預設交易對（Java 端會 fallback 查 OPEN trade）
    allowed-symbols:              # 允許的交易對清單（可加多個）
      - BTCUSDT

discord:
  webhook:
    url: ${DISCORD_WEBHOOK_URL:}                    # Discord Webhook URL（全局 fallback）
    enabled: ${DISCORD_WEBHOOK_ENABLED:false}       # 是否啟用通知
    # 多用戶 webhook 配置
    per-user:
      enabled: ${DISCORD_WEBHOOK_PER_USER_ENABLED:true}  # true = 使用用戶自定義 webhook，false = 使用全局
      fallback-to-global: ${DISCORD_WEBHOOK_FALLBACK:true}  # 用戶無自定義 webhook 時 fallback 到全局

stripe:
  secret-key: ${STRIPE_SECRET_KEY:sk_test_placeholder}
  webhook-secret: ${STRIPE_WEBHOOK_SECRET:whsec_placeholder}

jwt:
  secret: ${JWT_SECRET:default-dev-secret-change-in-production-must-be-at-least-256-bits-long}
  expiration-ms: 86400000         # 24h
  refresh-expiration-ms: 604800000  # 7 days

encryption:
  aes-key: ${AES_ENCRYPTION_KEY:default-aes-key-change-in-prod!!}

# Monitor API Key（Python Monitor 內部服務認證）
monitor:
  api-key: ${MONITOR_API_KEY:}

# AI 交易顧問
advisor:
  enabled: ${ADVISOR_ENABLED:false}
  gemini-api-key: ${GEMINI_API_KEY:}
  gemini-model: gemini-2.0-flash
  cron-expression: "0 0 2,6,10,14,18,22 * * *"
  max-response-tokens: 1024
  recent-trades-count: 10
  temperature-value: 0.7

logging:
  level:
    com.trader: DEBUG
