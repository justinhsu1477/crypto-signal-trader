# åˆ†æ•£å¼æ¶æ§‹ç­†è¨˜ï¼ˆé¢è©¦ç”¨ï¼‰

## ç›®å‰æ¶æ§‹ï¼šå–®æ©Ÿå–®ç”¨æˆ¶

```
Discord CDP Monitor (Python)
    â†’ POST /api/execute-trade
Spring Boot API (å–®æ©Ÿ, port 8080)
    â†’ Binance Futures API (ä¸‹å–®)
    â†’ WebSocket User Data Stream (1 æ¢é€£ç·š, ç›£è½ SL/TP)
    â†’ H2 File DB (./data/trading.mv.db)
```

---

## å•é¡Œï¼šå¦‚æœåšæˆ SaaSï¼Œ1000 å€‹ç”¨æˆ¶ï¼Ÿ

### WebSocket ç“¶é ¸

æ¯å€‹ç”¨æˆ¶éœ€è¦**ç¨ç«‹çš„ listenKey + ç¨ç«‹çš„ WebSocket é€£ç·š**ï¼ˆå¹£å®‰ API Key ä¸åŒï¼‰ã€‚

å–®æ©Ÿå•é¡Œï¼š
| å•é¡Œ | èªªæ˜ |
|------|------|
| å–®é»æ•…éšœ | æ©Ÿå™¨æ›äº†ï¼Œæ‰€æœ‰äººçš„ SL/TP ç›£è½å…¨æ–· |
| äº‹ä»¶è™•ç†é˜»å¡ | æŸç”¨æˆ¶çš„ DB å¯«å…¥å¡ä½ï¼Œå½±éŸ¿å…¶ä»–äººäº‹ä»¶è™•ç† |
| éƒ¨ç½²é‡å•Ÿ | æ›´æ–°ç¨‹å¼ç¢¼æ™‚æ‰€æœ‰ WebSocket å…¨æ–·å…¨é‡é€£ |
| keepalive é¢¨æš´ | 1000 äºº = æ¯ 30 åˆ†é˜ 1000 å€‹ HTTP PUT |

---

## åˆ†æ•£å¼ 3 å±¤æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 1: WS Manager                â”‚
â”‚         (å°ˆé–€ç®¡ WebSocket é€£ç·š)                   â”‚
â”‚                                                 â”‚
â”‚  Pod A: ç”¨æˆ¶ 1~500 çš„ WebSocket                  â”‚
â”‚  Pod B: ç”¨æˆ¶ 501~1000 çš„ WebSocket               â”‚
â”‚                                                 â”‚
â”‚  è·è²¬ï¼šåªè² è²¬ç¶­æŒé€£ç·š + æ”¶äº‹ä»¶                      â”‚
â”‚  æ”¶åˆ°äº‹ä»¶ â†’ publish åˆ° Message Queue â†’ çµæŸ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Layer 2: Message Queue               â”‚
â”‚           (Redis Streams / RabbitMQ)            â”‚
â”‚                                                 â”‚
â”‚  Queue: ws-events                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ {userId:A, event:SL_TRIGGERED, ...}  â”‚       â”‚
â”‚  â”‚ {userId:B, event:TP_CANCELED, ...}   â”‚       â”‚
â”‚  â”‚ {userId:C, event:SL_TRIGGERED, ...}  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Layer 3: Event Processor              â”‚
â”‚         (å°ˆé–€è™•ç†æ¥­å‹™é‚è¼¯)                         â”‚
â”‚                                                 â”‚
â”‚  Worker 1: å¾ Queue æ‹‰äº‹ä»¶ â†’ å¯« DB â†’ ç™¼é€šçŸ¥       â”‚
â”‚  Worker 2: å¾ Queue æ‹‰äº‹ä»¶ â†’ å¯« DB â†’ ç™¼é€šçŸ¥       â”‚
â”‚  Worker 3: å¾ Queue æ‹‰äº‹ä»¶ â†’ å¯« DB â†’ ç™¼é€šçŸ¥       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‚ºä»€éº¼è¦æ‹†ï¼Ÿå°æ¯”ç¨‹å¼ç¢¼

```java
// ç›®å‰ï¼ˆè€¦åˆï¼‰ï¼šæ”¶åˆ°äº‹ä»¶ â†’ ç›´æ¥è™•ç†ï¼Œå¯« DB å¡ä½å°±é˜»å¡ WebSocket
onMessage(text) {
    handleOrderTradeUpdate(json);         // è§£æ
    tradeRecordService.recordClose(...);  // å¯« DBï¼ˆå¯èƒ½æ…¢ï¼‰
    discordWebhookService.send(...);      // ç™¼é€šçŸ¥ï¼ˆå¯èƒ½æ…¢ï¼‰
}

// åˆ†æ•£å¼ï¼ˆè§£è€¦ï¼‰ï¼šæ”¶åˆ°äº‹ä»¶ â†’ ä¸Ÿ Queue â†’ é¦¬ä¸Šå›ä¾†ç¹¼çºŒæ”¶äº‹ä»¶
onMessage(text) {
    messageQueue.publish("ws-events", json);  // 0.1ms å®Œæˆ
}

// Worker ç¨ç«‹è™•ç†ï¼Œä¸å½±éŸ¿ WebSocket
@QueueListener("ws-events")
void process(event) {
    tradeRecordService.recordClose(...);  // æ…¢æ…¢å¯«
    discordWebhookService.send(...);      // æ…¢æ…¢ç™¼
}
```

---

## Message Queue æ˜¯ä»€éº¼

ç”Ÿæ´»æ¯”å–»ï¼šé¤å»³çš„å‡ºå–®æ©Ÿ/å«è™Ÿç³»çµ±

```
é¡§å®¢é»é¤ â†’ [å‡ºå–®æ©Ÿ] â†’ å»šæˆ¿åšèœ
            â†‘ Message Queue
```

- é¡§å®¢ä¸ç”¨ç«™åœ¨å»šæˆ¿å‰ç­‰
- å»šæˆ¿å¿™ä¸éä¾†ï¼Œå–®å­æ’éšŠä¸æœƒä¸Ÿ
- å¤šé–‹å¹¾å€‹å»šæˆ¿åŒæ™‚æ¶ˆåŒ–

### MQ è§£æ±ºçš„ 4 å€‹æ ¸å¿ƒå•é¡Œ

```
1. è§£è€¦     WS å±¤ä¸ç®¡ DB é‚è¼¯ï¼Œå„è‡ªç¨ç«‹éƒ¨ç½²æ›´æ–°
2. å‰Šå³°     1000 äººåŒæ™‚è§¸ç™¼ SL â†’ Queue æ’éšŠï¼ŒWorker æŒ‰é€Ÿåº¦æ¶ˆåŒ–
3. å¯é æ€§   Worker è™•ç†å¤±æ•— â†’ è¨Šæ¯ç•™åœ¨ Queue â†’ é‡è©¦
4. æ°´å¹³æ“´å±•  å¿™ â†’ å¤šé–‹ Workerï¼›é€£ç·šå¤š â†’ å¤šé–‹ WS Pod
```

### å¸¸è¦‹ MQ é¸å‹

| MQ | ç‰¹é» | é©åˆå ´æ™¯ |
|----|------|---------|
| Redis Streams | è¼•é‡ï¼Œå·²æœ‰ Redis å°±èƒ½ç”¨ | ä¸­å°è¦æ¨¡ï¼ˆ< è¬ç´š TPSï¼‰ |
| RabbitMQ | åŠŸèƒ½å®Œæ•´ï¼Œæ”¯æ´ ACK/é‡è©¦/æ­»ä¿¡ | ä¼æ¥­ç´šï¼Œéœ€è¦å¯é æŠ•é |
| Kafka | è¶…é«˜ååé‡ï¼ŒæŒä¹…åŒ–æ—¥èªŒ | å¤§æ•¸æ“šã€äº‹ä»¶æº¯æºã€æ—¥èªŒ |

---

## MQ äº‹ä»¶ç”Ÿå‘½é€±æœŸèˆ‡æ¸…ç†æ©Ÿåˆ¶

### è¨Šæ¯ç‹€æ…‹æµç¨‹

```
Producer ç™¼é€
    â†’ [pending] é€²å…¥ Queue ç­‰å¾…
    â†’ Consumer æ‹‰å– â†’ [processing] è™•ç†ä¸­
    â†’ Consumer ç™¼é€ ACK â†’ [acknowledged] å·²ç¢ºèª
    â†’ MQ è‡ªå‹•åˆªé™¤ï¼ˆæˆ–æ¨™è¨˜å·²æ¶ˆè²»ï¼‰
```

### èª°è² è²¬æ¸…ç†ï¼Ÿ

**Consumerï¼ˆæ¶ˆè²»è€…ï¼‰è™•ç†å®Œå¾Œç™¼ ACKï¼ŒMQ æ”¶åˆ° ACK å°±è‡ªå‹•æ¸…ç†ã€‚**

```java
// RabbitMQ ç¯„ä¾‹
@RabbitListener(queues = "ws-events")
void process(Message msg, Channel channel) {
    try {
        // è™•ç†æ¥­å‹™é‚è¼¯
        tradeRecordService.recordClose(...);

        // æˆåŠŸ â†’ ACK â†’ RabbitMQ è‡ªå‹•åˆªé™¤é€™æ¢è¨Šæ¯
        channel.basicAck(msg.getDeliveryTag(), false);

    } catch (Exception e) {
        // å¤±æ•— â†’ NACK â†’ è¨Šæ¯é‡æ–°å›åˆ° Queue ç­‰å¾…é‡è©¦
        channel.basicNack(msg.getDeliveryTag(), false, true);
    }
}
```

### è™•ç†å¤±æ•—æ€éº¼è¾¦ï¼Ÿï¼ˆDead Letter Queueï¼‰

```
æ­£å¸¸ Queue â”€â”€â†’ Consumer è™•ç†
    â”‚              â”‚
    â”‚         å¤±æ•—ï¼Œé‡è©¦ 3 æ¬¡
    â”‚              â”‚
    â”‚         é‚„æ˜¯å¤±æ•—
    â”‚              â–¼
    â””â”€â”€â”€â†’ Dead Letter Queue (DLQ)
              â”‚
              â–¼
         äººå·¥ä»‹å…¥ / å‘Šè­¦æ’æŸ¥
```

- é‡è©¦ N æ¬¡éƒ½å¤±æ•— â†’ è¨Šæ¯è½‰åˆ° DLQï¼ˆæ­»ä¿¡ä½‡åˆ—ï¼‰
- DLQ è£¡çš„è¨Šæ¯ä¸æœƒè‡ªå‹•è™•ç†ï¼Œç­‰å·¥ç¨‹å¸«æ’æŸ¥
- å¯ä»¥è¨­å®š DLQ å‘Šè­¦ï¼šã€Œæœ‰ 5 ç­†è¨Šæ¯é€² DLQï¼Œè«‹æª¢æŸ¥ã€

### å„ MQ çš„æ¸…ç†æ–¹å¼

| MQ | æ¸…ç†æ–¹å¼ |
|----|---------|
| RabbitMQ | Consumer ACK å¾Œè‡ªå‹•åˆªé™¤ï¼›å¯è¨­ TTL éæœŸè‡ªå‹•æ¸… |
| Redis Streams | Consumer XACK å¾Œæ¨™è¨˜å·²è®€ï¼›éœ€å®šæœŸ XTRIM è£å‰ªé•·åº¦ |
| Kafka | ä¸åˆªé™¤ï¼Œé  retention éæœŸï¼ˆå¦‚ä¿ç•™ 7 å¤©å¾Œè‡ªå‹•æ¸…ï¼‰ |

---

## å¤±æ•—è™•ç†ï¼š3 å±¤é˜²è­·ï¼ˆé˜²æ­¢ Server ç•¶æ‰ï¼‰

### å•é¡Œï¼šç„¡é™é‡è©¦æœƒæ€æ¨£ï¼Ÿ

```
è¨Šæ¯å¤±æ•— â†’ NACK â†’ å› Queue â†’ Consumer æ‹‰èµ° â†’ åˆå¤±æ•— â†’ NACK â†’ å› Queue
    â†‘                                                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç„¡é™å¾ªç’° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çµæœï¼š
- CPU 100%ï¼Œä¸€ç›´è™•ç†åŒä¸€æ¢å£è¨Šæ¯
- Queue è¢«å¡ä½ï¼Œå¾Œé¢æ­£å¸¸è¨Šæ¯ä¹Ÿè™•ç†ä¸äº†ï¼ˆéšŠé ­é˜»å¡ï¼‰
- Log ç˜‹ç‹‚åˆ·ï¼Œç£ç¢Ÿå¯«æ»¿ â†’ æ•´å° server æ›æ‰
```

### é˜²è­·è¨­è¨ˆ

```
                    è¨Šæ¯é€²å…¥ Queue
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          ç¬¬ 1 å±¤ â”‚  é‡è©¦æ¬¡æ•¸ä¸Šé™   â”‚  æœ€å¤šè©¦ 3 æ¬¡ + å»¶é²é€€é¿
                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    3 æ¬¡éƒ½å¤±æ•—
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          ç¬¬ 2 å±¤ â”‚  Dead Letter   â”‚  éš”é›¢å£è¨Šæ¯ï¼Œä¸å¡æ­£å¸¸æµç¨‹
                 â”‚  Queue (DLQ)  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                    DLQ å †ç©å¤ªå¤š
                         â”‚
                         â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          ç¬¬ 3 å±¤ â”‚  å‘Šè­¦ + ç›£æ§    â”‚  é€šçŸ¥å·¥ç¨‹å¸«ï¼Œå¿…è¦æ™‚æš«åœæ¶ˆè²»
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¬¬ 1 å±¤ï¼šé‡è©¦æ¬¡æ•¸ä¸Šé™ + å»¶é²é‡è©¦

```java
@RabbitListener(queues = "ws-events")
void process(Message msg) {
    int retryCount = getRetryCount(msg.getHeaders());

    if (retryCount >= 3) {
        // è¶…é 3 æ¬¡ â†’ ä¸Ÿåˆ° DLQï¼Œä¸å†é‡è©¦
        rabbitTemplate.send("ws-events.dlq", msg);
        log.error("è¨Šæ¯é‡è©¦ 3 æ¬¡ä»å¤±æ•—ï¼Œè½‰å…¥ DLQ: {}", msg.getBody());
        channel.basicAck(deliveryTag);  // ACK æ‰ï¼Œä¸è®“å®ƒå›ä¸» Queue
        return;
    }

    try {
        tradeRecordService.recordClose(...);
        channel.basicAck(deliveryTag);  // æˆåŠŸ
    } catch (Exception e) {
        log.warn("è™•ç†å¤±æ•— (ç¬¬{}æ¬¡): {}", retryCount + 1, e.getMessage());
        Thread.sleep(1000 * (retryCount + 1));  // å»¶é²: 1s, 2s, 3s
        channel.basicNack(deliveryTag);  // å› Queue é‡è©¦
    }
}
```

é‡é»ï¼š**å»¶é²é‡è©¦**ï¼Œä¸æ˜¯ç«‹åˆ»é‡è©¦ï¼Œé¿å…ç˜‹ç‹‚å¾ªç’°ã€‚

### ç¬¬ 2 å±¤ï¼šDead Letter Queueï¼ˆDLQï¼‰éš”é›¢å£è¨Šæ¯

```
ä¸» Queue: ws-events              DLQ: ws-events.dlq
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­£å¸¸è¨Šæ¯ A âœ…        â”‚         â”‚ å£è¨Šæ¯ Xï¼ˆDB æ¬„ä½éŒ¯ï¼‰â”‚
â”‚ æ­£å¸¸è¨Šæ¯ B âœ…        â”‚         â”‚ å£è¨Šæ¯ Yï¼ˆæ ¼å¼ä¸å°ï¼‰ â”‚
â”‚ æ­£å¸¸è¨Šæ¯ C âœ…        â”‚         â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  æ­£å¸¸æ¶ˆè²»ï¼Œä¸å¡ä½                  éš”é›¢å€ï¼Œç­‰å·¥ç¨‹å¸«æ’æŸ¥
```

DLQ å°±åƒé†«é™¢éš”é›¢ç—…æˆ¿ â€” å£è¨Šæ¯è¢«éš”é›¢ï¼Œä¸å½±éŸ¿å¥åº·è¨Šæ¯ã€‚

Consumer å´©æ½°ï¼ˆæ²’ç™¼ ACK ä¹Ÿæ²’ NACKï¼‰ï¼ŸMQ åµæ¸¬åˆ°é€£ç·šæ–·ï¼Œ**è‡ªå‹•æŠŠè¨Šæ¯æ”¾å› Queue** çµ¦å…¶ä»– Workerï¼Œè¨Šæ¯ä¸æœƒä¸Ÿã€‚

### ç¬¬ 3 å±¤ï¼šå‘Šè­¦ + ç›£æ§

```java
@Scheduled(fixedRate = 5 * 60 * 1000)  // æ¯ 5 åˆ†é˜
void checkDLQ() {
    long dlqSize = getDLQSize("ws-events.dlq");

    if (dlqSize > 0) {
        log.error("DLQ æœ‰ {} ç­†æœªè™•ç†è¨Šæ¯", dlqSize);
    }
    if (dlqSize >= 10) {
        // å †ç©å¤ªå¤š â†’ å¯èƒ½ç³»çµ±æ€§å•é¡Œï¼ˆDB æ›äº†ï¼Ÿï¼‰
        discordWebhookService.sendNotification(
            "ğŸš¨ DLQ å †ç©å‘Šè­¦",
            "ws-events.dlq æœ‰ " + dlqSize + " ç­†å¤±æ•—è¨Šæ¯\nè«‹ç«‹å³æ’æŸ¥",
            COLOR_RED);
    }
}
```

### æ€éº¼çœ‹ Logï¼Ÿ

**å–®æ©Ÿï¼ˆç›®å‰ï¼‰ï¼š**
```bash
tail -f logs/app.log                          # å³æ™‚çœ‹
grep "DLQ\|é‡è©¦.*å¤±æ•—\|NACK" logs/app.log     # æœå¤±æ•—
grep "userId=A" logs/app.log                  # æœç‰¹å®šç”¨æˆ¶
```

**ç”Ÿç”¢ç’°å¢ƒï¼ˆå¤šæ©Ÿï¼‰â€” Log é›†ä¸­å¹³å°ï¼š**
```
Worker 1 Log â”€â”
Worker 2 Log â”€â”€â”¼â”€â”€â†’ [ELK / Grafana Loki] â”€â”€â†’ çµ±ä¸€æœå°‹ä»‹é¢
Worker 3 Log â”€â”€â”˜

å¸¸è¦‹æ–¹æ¡ˆï¼š
- ELK Stackï¼ˆElasticsearch + Logstash + Kibanaï¼‰â€” æœ€ç¶“å…¸
- Grafana Loki â€” è¼•é‡ï¼Œé©åˆä¸­å°è¦æ¨¡
- CloudWatch / Cloud Logging â€” é›²ç«¯å…§å»º
```

çµæ§‹åŒ– Logï¼ˆJSONï¼‰+ é—œéµæ¬„ä½ï¼ˆuserId, tradeId, symbol, errorï¼‰â†’ æ¨é€åˆ°é›†ä¸­å¹³å° â†’ å¯æœå°‹ + å¯å‘Šè­¦ã€‚

### é¢è©¦ä¸€å¥è©±ç¸½çµ

> **é‡è©¦æœ‰ä¸Šé™ã€å¤±æ•—é€² DLQ éš”é›¢ã€DLQ å †ç©å°±å‘Šè­¦ã€‚ä¸‰å±¤é˜²è­·ç¢ºä¿å£è¨Šæ¯ä¸æœƒæ‹–å®æ•´å€‹ç³»çµ±ã€‚**

---

## é–çš„æ¼”é€²ï¼ˆé¢è©¦å¸¸å•ï¼‰

```
å–®æ©Ÿå–®ç”¨æˆ¶    â†’  JVM ReentrantLockï¼ˆper-symbolï¼‰
                 é›¶æˆæœ¬ï¼Œå–® CAS æ“ä½œ

å–®æ©Ÿå¤šç”¨æˆ¶    â†’  JVM Lock key æ”¹æˆ userId:symbol
                 æ¦‚å¿µä¸è®Šï¼Œåªæ˜¯ key åŠ äº† userId

åˆ†æ•£å¼å¤šæ©Ÿ    â†’  Redis åˆ†æ•£å¼é–ï¼ˆRedissonï¼‰
                 è·¨ JVM å”èª¿ï¼Œkey = userId:symbol
                 é©åˆå¤š Worker æ¶åŒä¸€äº‹ä»¶çš„å ´æ™¯
```

---

## æ¼”é€²è·¯ç·š

```
ç¾åœ¨ï¼ˆå–®äººï¼‰          100 äºº              1000+ äºº
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
H2 file DB     â†’  PostgreSQL      â†’  PG å¢é›† / è®€å¯«åˆ†é›¢
å–® WebSocket   â†’  HashMap<uid,WS> â†’  WS Manager å¤š Pod
åŒæ­¥è™•ç†       â†’  Redis Streams    â†’  RabbitMQ / Kafka
JVM Lock       â†’  JVM Lock        â†’  Redis åˆ†æ•£å¼é–
```
